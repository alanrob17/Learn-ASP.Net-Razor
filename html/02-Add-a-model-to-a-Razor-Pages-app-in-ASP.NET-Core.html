<!DOCTYPE html>
<html>
<head>
<title>02-Add-a-model-to-a-Razor-Pages-app-in-ASP.NET-Core.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="add-a-model-to-a-razor-pages-app-in-aspnet-core">Add a model to a Razor Pages app in ASP.NET Core</h1>
<p>In this tutorial, classes are added for managing movies in a database. The app's model classes use <a href="https://learn.microsoft.com/en-us/ef/core">Entity Framework Core (EF Core)</a> to work with the database. EF Core is an object-relational mapper (O/RM) that simplifies data access. You write the model classes first, and EF Core creates the database.</p>
<p>The model classes are known as <code>POCO</code> classes (from &quot;Plain-Old CLR Objects&quot;) because they don't have a dependency on EF Core. They define the properties of the data that are stored in the database.</p>
<p>In Solution Explorer, right-click the <code>RazorPagesMovie</code> project &gt; Add &gt; New Folder. Name the folder <code>Models</code>.</p>
<p>Right-click the <code>Models</code> folder. Select Add &gt; Class. Name the class <code>Movie</code>.</p>
<p>Add the following properties to the <code>Movie</code> class:</p>
<pre class="hljs"><code><div>using System.ComponentModel.DataAnnotations;

namespace RazorPagesMovie.Models;

public class Movie
{
    public int Id { get; <span class="hljs-built_in">set</span>; }
    public string? Title { get; <span class="hljs-built_in">set</span>; }
    [DataType(DataType.Date)]
    public DateTime ReleaseDate { get; <span class="hljs-built_in">set</span>; }
    public string? Genre { get; <span class="hljs-built_in">set</span>; }
    public decimal Price { get; <span class="hljs-built_in">set</span>; }
}
</div></code></pre>
<p>The Movie class contains:</p>
<p>The <code>ID</code> field is required by the database for the primary key.</p>
<p>A <a href="https://learn.microsoft.com/en-us/dotnet/api/system.componentmodel.dataannotations.datatypeattribute">DataType</a> attribute that specifies the type of data in the ReleaseDate property. With this attribute:</p>
<p>The user isn't required to enter time information in the date field.</p>
<p>Only the date is displayed, not time information.</p>
<p>The question mark after string indicates that the property is <code>nullable</code>. For more information, see <a href="https://learn.microsoft.com/en-us/dotnet/csharp/nullable-references">Nullable reference types</a>.</p>
<p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.componentmodel.dataannotations">DataAnnotations</a> are covered in a later tutorial.</p>
<p>Build the project to verify there are no compilation errors.</p>
<h2 id="scaffold-the-movie-model">Scaffold the movie model</h2>
<p>In this section, the movie model is scaffolded. That is, the scaffolding tool produces pages for Create, Read, Update, and Delete (CRUD) operations for the movie model.</p>
<p>Create the <code>Pages/Movies</code> folder:</p>
<p>Right-click on the Pages folder &gt; Add &gt; New Folder. Name the folder <code>Movies</code>.</p>
<p>Right-click on the <code>Pages/Movies</code> folder &gt; Add &gt; New Scaffolded Item.</p>
<p>In the Add New Scaffold dialog, select <code>Razor Pages using Entity Framework (CRUD)</code> &gt; Add.</p>
<p>Complete the Add Razor Pages using Entity Framework (CRUD) dialog:</p>
<p>In the Model class drop down, select <code>Movie (RazorPagesMovie.Models)</code>.</p>
<p>In the Data context class row, select the <code>+ (plus)</code> sign.</p>
<p>In the Add Data Context dialog, the class name <code>RazorPagesMovie.Data.RazorPagesMovieContext</code> is generated.</p>
<p>In the Database provider drop down, select <code>SQL Server</code>.</p>
<p>Select <code>Add</code>.</p>
<h3 id="files-created-and-updated">Files created and updated</h3>
<p>The scaffold process creates the following files:</p>
<p>Pages/Movies: Create, Delete, Details, Edit, and Index.</p>
<p>Data/RazorPagesMovieContext.cs</p>
<p>The created files are explained in the next tutorial.</p>
<p>The scaffold process adds the following code to the <code>Program.cs</code> file:</p>
<pre class="hljs"><code><div>using Microsoft.EntityFrameworkCore;
using Microsoft.Extensions.DependencyInjection;
using RazorPagesMovie.Data;
namespace RazorPagesMovie
{
    public class Program
    {
        public static void Main(string[] args)
        {
            var builder = WebApplication.CreateBuilder(args);
            builder.Services.AddDbContext&lt;RazorPagesMovieContext&gt;(options =&gt;
                options.UseSqlServer(builder.Configuration.GetConnectionString(<span class="hljs-string">"RazorPagesMovieContext"</span>) ?? throw new InvalidOperationException(<span class="hljs-string">"Connection string 'RazorPagesMovieContext' not found."</span>)));

            // Add services to the container.
            builder.Services.AddRazorPages();

            var app = builder.Build();

            // Configure the HTTP request pipeline.
            <span class="hljs-keyword">if</span> (!app.Environment.IsDevelopment())
            {
                app.UseExceptionHandler(<span class="hljs-string">"/Error"</span>);
                // The default HSTS value is 30 days. You may want to change this <span class="hljs-keyword">for</span> production scenarios, see https://aka.ms/aspnetcore-hsts.
                app.UseHsts();
            }

            app.UseHttpsRedirection();

            app.UseRouting();

            app.UseAuthorization();

            app.MapStaticAssets();
            app.MapRazorPages()
               .WithStaticAssets();

            app.Run();
        }
    }
}
</div></code></pre>
<h2 id="create-the-initial-database-schema-using-efs-migration-feature">Create the initial database schema using EF's migration feature</h2>
<p>The migrations feature in Entity Framework Core provides a way to:</p>
<p>Create the initial database schema.</p>
<p>Incrementally update the database schema to keep it in sync with the app's data model. Existing data in the database is preserved.</p>
<p>In this section, the <strong>Package Manager Console (PMC)</strong> window is used to:</p>
<p>Add an initial migration.</p>
<p>Update the database with the initial migration.</p>
<p>From the Tools menu, select <strong>NuGet Package Manager &gt; Package Manager Console</strong>.</p>
<p>In the PMC, enter the following command:</p>
<pre class="hljs"><code><div>    Add-Migration InitialCreate
</div></code></pre>
<p>The <code>Add-Migration</code> command generates code to create the initial database schema. The schema is based on the model specified in <code>DbContext</code>. The <code>InitialCreate</code> argument is used to name the migration. Any name can be used, but by convention a name is selected that describes the migration.</p>
<p>The following warning is displayed, which is addressed in a later step:</p>
<p>No type was specified for the decimal column 'Price' on entity type 'Movie'. This will cause values to be silently truncated if they do not fit in the default precision and scale. Explicitly specify the SQL server column type that can accommodate all the values using 'HasColumnType()'.</p>
<p>In the PMC, enter the following command:</p>
<pre class="hljs"><code><div>    Update-Database
</div></code></pre>
<p>The <code>Update-Database</code> command runs the <code>Up</code> method in migrations that have not been applied. In this case, the command runs the <code>Up</code> method in the <code>Migrations/&lt;time-stamp&gt;_InitialCreate.cs</code> file, which creates the database.</p>
<p>The data context <code>RazorPagesMovieContext</code>:</p>
<p>Derives from <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.entityframeworkcore.dbcontext">Microsoft.EntityFrameworkCore.DbContext</a>.</p>
<p>Specifies which entities are included in the data model.</p>
<p>Coordinates EF Core functionality, such as Create, Read, Update and Delete, for the <code>Movie</code> model.</p>
<p>The <code>RazorPagesMovieContext</code> class in the generated file <code>Data/RazorPagesMovieContext.cs</code>:</p>
<pre class="hljs"><code><div>using System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;
using Microsoft.EntityFrameworkCore;
using RazorPagesMovie.Models;

namespace RazorPagesMovie.Data
{
    public class RazorPagesMovieContext : DbContext
    {
        public RazorPagesMovieContext (DbContextOptions&lt;RazorPagesMovieContext&gt; options)
            : base(options)
        {
        }

        public DbSet&lt;RazorPagesMovie.Models.Movie&gt; Movie { get; <span class="hljs-built_in">set</span>; } = default!;
    }
}
</div></code></pre>
<p>The preceding code creates a <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.entityframeworkcore.dbset-1">DbSet<Movie></a> property for the entity set. In Entity Framework terminology, an entity set typically corresponds to a database table. An entity corresponds to a row in the table.</p>
<p>The name of the connection string is passed in to the context by calling a method on a <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.entityframeworkcore.dbcontextoptions">DbContextOptions</a> object. For local development, the <a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/configuration/?view=aspnetcore-9.0">Configuration system</a> reads the connection string from the <code>appsettings.json</code> file.</p>
<h3 id="test-the-app">Test the app</h3>
<p>Run the app and append <code>/Movies</code> to the URL in the browser (http://localhost:port/movies). Add a new movie, edit it and delete it.</p>
<h2 id="examine-the-context-registered-with-dependency-injection">Examine the context registered with dependency injection</h2>
<p>ASP.NET Core is built with <a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/dependency-injection?view=aspnetcore-9.0">dependency injection</a>. Services, such as the EF Core database context, are registered with dependency injection during application startup. Components that require these services (such as Razor Pages) are provided via constructor parameters. The constructor code that gets a database context instance is shown later in the tutorial.</p>
<p>The scaffolding tool automatically created a database context and registered it with the dependency injection container. The following highlighted code is added to the <code>Program.cs</code> file by the scaffolder:</p>
<pre class="hljs"><code><div>builder.Services.AddDbContext&lt;RazorPagesMovieContext&gt;(options =&gt;
    options.UseSqlServer(builder.Configuration.GetConnectionString(<span class="hljs-string">"RazorPagesMovieContext"</span>) ?? throw new InvalidOperationException(<span class="hljs-string">"Connection string 'RazorPagesMovieContext' not found."</span>)));
</div></code></pre>

</body>
</html>
